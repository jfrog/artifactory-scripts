# Apache configuration for artifactory, minimal with artifactory running on the same machine as httpd                                                                                                      


RewriteEngine On
RewriteRule   ^/artifactory$ /artifactory/   [R,L]
RewriteRule   ^/$ /artifactory/ [R,L]

ProxyRequests off
ProxyPreserveHost on

SSLCertificateFile      /etc/pki/tls/certs/example.pem
SSLCertificateKeyFile   /etc/pki/tls/private/example.key
SSLProxyEngine on

SetEnv            proxy-sendcl 1

# If SSL is terminated before this server, add to resolve "501 Method not implemented"                                                                                                                   
RequestHeader set X-Forwarded-Proto "https"

<VirtualHost *:443>
  SSLEngine on

  ProxyPass /artifactory/ http://localhost:8081/artifactory/

  ProxyPass         /v1 http://localhost:8081/artifactory/api/docker/docker-dev-local/v1
  ProxyPassReverse  /v1 http://localhost:8081/artifactory/api/docker/docker-dev-local/v1
  ProxyPass         /v2 http://localhost:8081/artifactory/api/docker/docker-virtual/v2
  ProxyPassReverse  /v2 http://localhost:8081/artifactory/api/docker/docker-virtual/v2

</VirtualHost>

Listen 5000
<VirtualHost *:5000>
  SSLEngine on

  ProxyPass         /v1 http://localhost:8081/artifactory/api/docker/docker-dev-local/v1
  ProxyPassReverse  /v1 http://localhost:8081/artifactory/api/docker/docker-dev-local/v1
  ProxyPass         /v2 http://localhost:8081/artifactory/api/docker/docker-dev-local2/v2
  ProxyPassReverse  /v2 http://localhost:8081/artifactory/api/docker/docker-dev-local2/v2

</VirtualHost>

Listen 5001
<VirtualHost *:5001>
  SSLEngine on

  ProxyPass         /v1 http://localhost:8081/artifactory/api/docker/docker-prod-local/v1
  ProxyPassReverse  /v1 http://localhost:8081/artifactory/api/docker/docker-prod-local/v1
  ProxyPass         /v2 http://localhost:8081/artifactory/api/docker/docker-prod-local2/v2
  ProxyPassReverse  /v2 http://localhost:8081/artifactory/api/docker/docker-prod-local2/v2

</VirtualHost>
